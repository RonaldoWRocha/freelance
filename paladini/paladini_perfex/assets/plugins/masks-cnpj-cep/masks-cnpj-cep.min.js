const custom_field_whatsapp=$('[id="custom_fields[customers][13]"]'), // WHATSAPP - CAMPO PERSONALIZADO
      custom_field_razao_social=$('[id="custom_fields[customers][10]"]'), // RAZÃO SOCIAL - CAMPO PERSONALIZADO
      custom_field_atividade_principal=$('[id="custom_fields[customers][11]"]'), // ATIVIDADE PRINCIPAL - CAMPO PERSONALIZADO
      custom_field_email=$('[id="custom_fields[customers][12]"]'); // EMAIL - CAMPO PERSONALIZADO

$(document).ready(function(){cnpj.init($("#vat")),phone.init($("#phonenumber")),phone.init(custom_field_whatsapp),cep.init($("#zip"))});let phone={init:o=>{o.mask(phone.mascara,phone.opcoes)},mascara:o=>11===o.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009",opcoes:{onKeyPress:function(o,e,a,t){a.mask(phone.mascara.apply({},arguments),t)}}},cnpj={init:o=>{o.blur(function(){cnpj.buscar(o)}),cnpj.mascara(o)},mascara:o=>{o.length&&o.mask(o.val().length>11?"00.000.000/0000-00":"000.000.000-00#",cnpj.opcoes)},opcoes:{onKeyPress:function(o,e,a,t){var i=["000.000.000-000","00.000.000/0000-00"];a.mask(o.length>14?i[1]:i[0],t)},onComplete:(o,e,a)=>{18==o.length&&a.blur()}},buscar:o=>{let e=o.cleanVal(),a="https://www.receitaws.com.br/v1/cnpj/"+e;14==e.length&&$.ajax({url:a,dataType:"jsonp",beforeSend:cnpj.modal_consultando(),success:function(o){if(null===o)return cnpj.modal_try_again();"ATIVA"!=o.situacao&&"ERROR"!=o.status?cnpj.modal_situation_not_active(o):("OK"==o.status?cnpj.modal_status_ok():"ERROR"==o.status&&cnpj.modal_status_error(o.message),"ERROR"!=o.status&&cnpj.inserirDados(o))},error:function(){cnpj.modal_try_again()}})},inserirDados:o=>{let e=o.cep.replace(".",""),a={num:o.numero,complemento:o.complemento};$("#contact_info #zip").val(e),cep.buscar(a),custom_field_razao_social.val(o.nome),$("#contact_info #company").val(o.fantasia),custom_field_atividade_principal.val(o.atividade_principal[0].text+" ("+o.atividade_principal[0].code+")"),custom_field_email.val(o.email),$("#contact_info #phonenumber").val(o.telefone),$("#contact_info #email").val(o.email)},modal_consultando:()=>{Swal.fire({title:"Consultando CNPJ...",timer:1e4,onBeforeOpen:()=>{Swal.showLoading()},onClose:()=>{clearInterval()}})},modal_situation_not_active:o=>{Swal.fire({title:"Oops...",html:"O CNPJ informado está com a situação cadastral <b>"+o.situacao+"</b> por motivos de <b>"+o.motivo_situacao+"</b> desde <b>"+o.data_situacao+"</b>.<br/><br/>Deseja continuar mesmo assim?<br /><small>Ao concordar, você permite preenchermos os dados.</small>",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sim",cancelButtonText:"Cancelar"}).then(e=>{e.dismiss||cnpj.inserirDados(o)})},modal_status_ok:()=>{Swal.fire({icon:"success",title:"Dados do CNPJ importados com sucesso!",showConfirmButton:!1,timer:2e3})},modal_status_error:o=>{Swal.fire({icon:"error",title:"Oops...",text:o,showConfirmButton:!1,timer:2500})},modal_try_again:()=>{Swal.fire({icon:"error",title:"Oops...",text:"Algo deu errado, aguarde alguns segundos para tentar novamente!",showConfirmButton:!1,timer:2500})}},cep={init:o=>{o.blur(function(){cep.buscar()}),cep.mascara(o)},buscar:o=>{let e=$("#zip").cleanVal(),a=/^[0-9]{8}$/.test(e),t="https://viacep.com.br/ws/"+e+"/json/?callback=?";""!==e&&(a?(o||cep.modal_buscando(),$.getJSON(t,function(e){"erro"in e?(cep.modal_naoEncontrado(),cep.limparDados()):o?cep.inserirDados(e,o):(cep.modal_encontrado(),cep.inserirDados(e))})):(cep.modal_incompleto(),cep.limparDados()))},mascara:o=>{var e={onKeyPress:function(o,e,a,t){$("#zip").mask("00000-000",t)},onComplete:()=>{o.blur()}};$("#zip").mask("00000-000",e)},modal_buscando:()=>{Swal.fire({title:"Buscando CEP...",timer:1e4,onBeforeOpen:()=>{Swal.showLoading()},onClose:()=>{clearInterval()}})},modal_encontrado:()=>{Swal.fire({icon:"success",title:"CEP Encontrado e Preenchido!",showConfirmButton:!1,timer:2e3})},modal_incompleto:()=>{Swal.fire({icon:"error",title:"CEP Incompleto",html:"O CEP informado está <b>incompleto</b>!",showConfirmButton:!1,timer:2e3})},modal_naoEncontrado:()=>{Swal.fire({icon:"warning",title:"CEP não encontrado",html:"Verifique se o CEP <b>"+$("#zip").val()+"</b> está correto. Caso esteja, digite o endereço manualmente!"})},inserirDados:(o,e)=>{let a=o.logradouro;e&&(""!==e.num&&(a+=", Nº "+e.num),""!==e.complemento&&(a+=" – Complemento: "+e.complemento)),a+=" – "+o.bairro,$("#zip, #billing_zip, #shipping_zip").val(o.cep),$("#address, #billing_street, #shipping_street").val(a),$("#city, #billing_city, #shipping_city").val(o.localidade),$("#state, #billing_state, #shipping_state").val(o.uf),$("#billing_country, #shipping_country").val("32").selectpicker("refresh")},limparDados:()=>{$("#billing_zip, #shipping_zip").val(""),$("#address, #billing_street, #shipping_street").val(""),$("#city, #billing_city, #shipping_city").val(""),$("#state, #billing_state, #shipping_state").val(""),$("#billing_country .filter-option-inner-inner, #shipping_country .filter-option-inner-inner").text("")}};